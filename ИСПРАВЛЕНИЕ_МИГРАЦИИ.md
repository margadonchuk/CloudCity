# Исправление ошибки миграции для SQL Server

## Проблема
Миграция `20250911222054_InitialCreate` была создана для SQLite и использует типы данных `TEXT` и `INTEGER`, которые не подходят для SQL Server.

## Решение

Нужно создать новую миграцию специально для SQL Server. Выполните на сервере:

```bash
cd /home/siteadmin/cloudcity/CloudCityCenter

# 1. Убедитесь, что используете Production окружение
export ASPNETCORE_ENVIRONMENT=Production

# 2. Установите строку подключения к SQL Server
export ConnectionStrings__DefaultConnection="Server=10.151.10.8;Database=CloudCityDB;User Id=sa;Password=ВАШ_ПАРОЛЬ;TrustServerCertificate=True;MultipleActiveResultSets=true"

# 3. Удалите старую папку Migrations (или переименуйте её)
# ВАЖНО: Сделайте резервную копию, если нужно!
# mv Migrations Migrations_sqlite_backup

# 4. Создайте новую миграцию для SQL Server
dotnet ef migrations add InitialCreateForSqlServer --context ApplicationDbContext

# 5. Примените миграцию
dotnet ef database update --context ApplicationDbContext

# 6. Загрузите данные
dotnet run -- --migrate-data
```

## Альтернативный способ (без удаления миграций)

Если вы хотите сохранить старые миграции для SQLite:

```bash
cd /home/siteadmin/cloudcity/CloudCityCenter
export ASPNETCORE_ENVIRONMENT=Production
export ConnectionStrings__DefaultConnection="Server=10.151.10.8;Database=CloudCityDB;User Id=sa;Password=ВАШ_ПАРОЛЬ;TrustServerCertificate=True;MultipleActiveResultSets=true"

# Создайте новую миграцию с другим именем
dotnet ef migrations add SqlServerInitialCreate

# Примените только эту миграцию
dotnet ef database update --context ApplicationDbContext
```

## Если база данных уже создана

Если таблицы уже частично созданы, удалите их и начните заново:

```sql
-- В SQL Server Management Studio на 10.151.10.8
USE CloudCityDB;
GO

-- Удалите все таблицы (осторожно!)
DROP TABLE IF EXISTS ProductFeatures;
DROP TABLE IF EXISTS ProductVariants;
DROP TABLE IF EXISTS Products;
DROP TABLE IF EXISTS OrderItems;
DROP TABLE IF EXISTS Orders;
DROP TABLE IF EXISTS Servers;
-- Identity таблицы
DROP TABLE IF EXISTS AspNetUserClaims;
DROP TABLE IF EXISTS AspNetUserLogins;
DROP TABLE IF EXISTS AspNetUserRoles;
DROP TABLE IF EXISTS AspNetUserTokens;
DROP TABLE IF EXISTS AspNetRoleClaims;
DROP TABLE IF EXISTS AspNetRoles;
DROP TABLE IF EXISTS AspNetUsers;
DROP TABLE IF EXISTS __EFMigrationsHistory;
GO
```

Затем выполните миграцию заново.

















