# Инструкция по откату к состоянию неделю назад

## Важно! 
Откат кода через git НЕ восстановит данные в базе данных. Данные в базе данных нужно восстанавливать отдельно через бэкап.

## Откат кода к коммиту неделю назад:

### Шаг 1: Найдите коммит неделю назад

```bash
git log --all --format="%h %ad %s" --date=short
```

Найдите коммит от 25-26 декабря 2025 года (примерно неделю назад).

### Шаг 2: Откатите код к этому коммиту

**Вариант A: Hard reset (ОПАСНО - потеряете все незакоммиченные изменения)**

```bash
# Найдите хэш коммита неделю назад, например: 563cb88
git reset --hard 563cb88  # ЗАМЕНИТЕ на реальный хэш коммита
git push --force  # ОПАСНО! Перезапишет удаленную ветку
```

**Вариант B: Создать новую ветку с откатом (БЕЗОПАСНО)**

```bash
# Создать новую ветку от коммита неделю назад
git checkout -b restore-week-ago 563cb88  # ЗАМЕНИТЕ на реальный хэш
git push origin restore-week-ago

# Затем на сервере переключиться на эту ветку
cd /home/siteadmin/cloudcity
git fetch
git checkout restore-week-ago
```

### Шаг 3: На сервере

```bash
cd /home/siteadmin/cloudcity
git fetch
git checkout <branch-or-commit>
cd CloudCityCenter
dotnet build --configuration Release
sudo systemctl restart cloudcity
```

## Восстановление данных в базе данных

Код можно откатить, но данные в базе данных нужно восстанавливать отдельно:

1. **Если есть бэкап базы данных:**
```bash
# Восстановить из бэкапа
sqlcmd -S 10.151.10.8 -U sa -P "пароль" -Q "RESTORE DATABASE CloudCityDB FROM DISK = '/path/to/backup.bak' WITH REPLACE;"
```

2. **Если нет бэкапа - данные потеряны**, нужно будет:
   - Заново добавить продукты через админ-панель
   - Или использовать seed данные: `dotnet run --project CloudCityCenter -- --seed`

## Рекомендация

**НЕ делайте force push в main ветку!** Лучше создать новую ветку с откатом и протестировать там.

