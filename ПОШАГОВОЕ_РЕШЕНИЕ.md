# ÐŸÐ¾ÑˆÐ°Ð³Ð¾Ð²Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð²ÑÐµÑ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

## ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 1: `dotnet ef` Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ EF Core tools
dotnet tool install --global dotnet-ef

# Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² PATH (ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾)
export PATH="$PATH:$HOME/.dotnet/tools"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ
dotnet ef --version
```

## ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 2: "Invalid column name 'slug'"

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð½Ñ‹ Ð±ÐµÐ· ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ `slug` Ð¸Ð»Ð¸ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð½Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ð»Ð°ÑÑŒ.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ Ð²ÑÐµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð·Ð°Ð½Ð¾Ð²Ð¾ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ.

## ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 3: ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ Products

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** Ð•ÑÑ‚ÑŒ Ð²Ð½ÐµÑˆÐ½Ð¸Ðµ ÐºÐ»ÑŽÑ‡Ð¸ Ð¾Ñ‚ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ñ‚Ð°Ð±Ð»Ð¸Ñ†.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:** Ð£Ð´Ð°Ð»ÑÐ¹Ñ‚Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ (ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð´Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ðµ).

---

## âœ… ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ (Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð¿Ð¾ Ð¿Ð¾Ñ€ÑÐ´ÐºÑƒ)

### Ð¨Ð°Ð³ 1: Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ EF Core Tools

```bash
cd /home/siteadmin/cloudcity/CloudCityCenter
dotnet tool install --global dotnet-ef
export PATH="$PATH:$HOME/.dotnet/tools"
dotnet ef --version
```

### Ð¨Ð°Ð³ 2: Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ Ð²ÑÐµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð² SQL Server

ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ SQL Server Management Studio Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ `drop_all_tables.sql`:

```sql
USE CloudCityDB;
GO

-- Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ
IF OBJECT_ID('dbo.ProductFeatures', 'U') IS NOT NULL DROP TABLE dbo.ProductFeatures;
IF OBJECT_ID('dbo.ProductVariants', 'U') IS NOT NULL DROP TABLE dbo.ProductVariants;
IF OBJECT_ID('dbo.OrderItems', 'U') IS NOT NULL DROP TABLE dbo.OrderItems;
IF OBJECT_ID('dbo.Orders', 'U') IS NOT NULL DROP TABLE dbo.Orders;
IF OBJECT_ID('dbo.Products', 'U') IS NOT NULL DROP TABLE dbo.Products;
IF OBJECT_ID('dbo.Servers', 'U') IS NOT NULL DROP TABLE dbo.Servers;
IF OBJECT_ID('dbo.AspNetUserClaims', 'U') IS NOT NULL DROP TABLE dbo.AspNetUserClaims;
IF OBJECT_ID('dbo.AspNetUserLogins', 'U') IS NOT NULL DROP TABLE dbo.AspNetUserLogins;
IF OBJECT_ID('dbo.AspNetUserRoles', 'U') IS NOT NULL DROP TABLE dbo.AspNetUserRoles;
IF OBJECT_ID('dbo.AspNetUserTokens', 'U') IS NOT NULL DROP TABLE dbo.AspNetUserTokens;
IF OBJECT_ID('dbo.AspNetRoleClaims', 'U') IS NOT NULL DROP TABLE dbo.AspNetRoleClaims;
IF OBJECT_ID('dbo.AspNetRoles', 'U') IS NOT NULL DROP TABLE dbo.AspNetRoles;
IF OBJECT_ID('dbo.AspNetUsers', 'U') IS NOT NULL DROP TABLE dbo.AspNetUsers;
IF OBJECT_ID('dbo.__EFMigrationsHistory', 'U') IS NOT NULL DROP TABLE dbo.__EFMigrationsHistory;
GO
```

### Ð¨Ð°Ð³ 3: Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð¸ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ðµ

```bash
cd /home/siteadmin/cloudcity/CloudCityCenter

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
export ASPNETCORE_ENVIRONMENT=Production

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
export ConnectionStrings__DefaultConnection="Server=10.151.10.8;Database=CloudCityDB;User Id=sa;Password=Ð’ÐÐ¨_ÐŸÐÐ ÐžÐ›Ð¬;TrustServerCertificate=True;MultipleActiveResultSets=true"

# Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
rm -rf Migrations

# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²ÑƒÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ Ð´Ð»Ñ SQL Server
dotnet ef migrations add InitialCreateForSqlServer

# ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ
dotnet ef database update
```

### Ð¨Ð°Ð³ 4: Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ

```bash
# Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ñ‚Ð¾Ð²Ð°Ñ€Ñ‹ Ð¸ ÑƒÑÐ»ÑƒÐ³Ð¸
dotnet run -- --migrate-data
```

### Ð¨Ð°Ð³ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚

Ð’ SQL Server Management Studio:

```sql
USE CloudCityDB;
SELECT COUNT(*) as ProductsCount FROM Products;  -- Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 16
SELECT COUNT(*) as VariantsCount FROM ProductVariants;  -- Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 16
SELECT COUNT(*) as FeaturesCount FROM ProductFeatures;  -- Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ ~80-100

-- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Products
SELECT COLUMN_NAME, DATA_TYPE 
FROM INFORMATION_SCHEMA.COLUMNS 
WHERE TABLE_NAME = 'Products'
ORDER BY ORDINAL_POSITION;
```

Ð”Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ° `Slug` (Ñ Ð±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ Ð±ÑƒÐºÐ²Ñ‹ Ð² SQL Server).

---

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð± (Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚)

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚:

```bash
cd /home/siteadmin/cloudcity/CloudCityCenter
chmod +x setup_and_migrate.sh

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
export ConnectionStrings__DefaultConnection="Server=10.151.10.8;Database=CloudCityDB;User Id=sa;Password=Ð’ÐÐ¨_ÐŸÐÐ ÐžÐ›Ð¬;TrustServerCertificate=True;MultipleActiveResultSets=true"

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚
./setup_and_migrate.sh
```

**Ð’ÐÐ–ÐÐž:** ÐŸÐµÑ€ÐµÐ´ Ð·Ð°Ð¿ÑƒÑÐºÐ¾Ð¼ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° ÑƒÐ´Ð°Ð»Ð¸Ñ‚Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ñ‡ÐµÑ€ÐµÐ· SQL ÑÐºÑ€Ð¸Ð¿Ñ‚ `drop_all_tables.sql`!

---

## ðŸ” Ð•ÑÐ»Ð¸ Ñ‡Ñ‚Ð¾-Ñ‚Ð¾ Ð¿Ð¾ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº

1. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ:**
   ```bash
   echo $ConnectionStrings__DefaultConnection
   ```

2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ:**
   ```bash
   echo $ASPNETCORE_ENVIRONMENT
   ```
   Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ `Production`

3. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ SQL Server:**
   ```bash
   telnet 10.151.10.8 1433
   ```

4. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸:**
   ```bash
   dotnet run -- --migrate-data 2>&1 | tee migration.log
   ```













