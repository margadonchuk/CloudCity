@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@using System.Linq
@model CloudCityCenter.Models.ViewModels.ProductCardVm
@{
    var imageUrl = string.IsNullOrWhiteSpace(Model.ImageUrl)
        ? "https://via.placeholder.com/300x200?text=No+Image"
        : Model.ImageUrl;
    
    // Функция для локализации названий и значений характеристик
    string LocalizeFeature(string feature)
    {
        if (string.IsNullOrWhiteSpace(feature))
            return feature;
        
        // Разбиваем строку на название характеристики и значение (например, "CPU: 1 core")
        var parts = feature.Split(new[] { ':' }, 2);
        if (parts.Length == 2)
        {
            var featureName = parts[0].Trim();
            var featureValue = parts[1].Trim();
            
            // Пытаемся локализовать название характеристики
            var localizedName = Localizer[featureName].Value;
            if (localizedName == featureName) // Если локализация не найдена, используем оригинал
            {
                localizedName = featureName;
            }
            
            // Пытаемся локализовать значение характеристики
            var localizedValue = LocalizeFeatureValue(featureValue);
            
            return $"{localizedName}: {localizedValue}";
        }
        
        // Если формат не "Name: Value", пытаемся локализовать всю строку
        var localized = Localizer[feature].Value;
        return localized != feature ? localized : feature;
    }
    
    // Функция для локализации значений характеристик
    string LocalizeFeatureValue(string value)
    {
        if (string.IsNullOrWhiteSpace(value))
            return value;
        
        // Пытаемся локализовать значение целиком
        var localized = Localizer[value].Value;
        if (localized != value)
            return localized;
        
        // Если значение содержит несколько стран через "/", локализуем каждую
        if (value.Contains("/"))
        {
            var parts = value.Split(new[] { '/' }, StringSplitOptions.RemoveEmptyEntries);
            var localizedParts = parts.Select(part => 
            {
                var trimmed = part.Trim();
                var loc = Localizer[trimmed].Value;
                return loc != trimmed ? loc : trimmed;
            });
            return string.Join("/", localizedParts);
        }
        
        // Если значение содержит несколько элементов через ",", локализуем каждую часть
        if (value.Contains(","))
        {
            var parts = value.Split(new[] { ',' }, StringSplitOptions.RemoveEmptyEntries);
            var localizedParts = parts.Select(part => 
            {
                var trimmed = part.Trim();
                var loc = Localizer[trimmed].Value;
                return loc != trimmed ? loc : trimmed;
            });
            return string.Join(", ", localizedParts);
        }
        
        // Если значение содержит "+", локализуем каждую часть
        if (value.Contains("+"))
        {
            var parts = value.Split(new[] { '+' }, StringSplitOptions.RemoveEmptyEntries);
            var localizedParts = parts.Select(part => 
            {
                var trimmed = part.Trim();
                var loc = Localizer[trimmed].Value;
                return loc != trimmed ? loc : trimmed;
            });
            return string.Join(" + ", localizedParts);
        }
        
        return value;
    }
}
<img src="@imageUrl" class="card-img-top" alt="@Model.Name" />
<div class="card-body">
    <h5 class="card-title">@Model.Name</h5>
    <ul class="list-unstyled small">
    @foreach (var feature in Model.TopFeatures)
    {
        <li>@LocalizeFeature(feature)</li>
    }
    </ul>
    <p class="card-text fw-semibold">$@Model.PricePerMonth / @Localizer["Month"]</p>
    <form asp-controller="Cart" asp-action="Add" method="post" class="add-to-cart-form" data-ajax="true">
        @Html.AntiForgeryToken()
        <input type="hidden" name="productId" value="@Model.Id" />
        @if (Model.ProductVariantId.HasValue)
        {
            <input type="hidden" name="productVariantId" value="@Model.ProductVariantId" />
        }
        <button type="submit" class="btn btn-primary">@Localizer["Order"]</button>
    </form>
</div>
