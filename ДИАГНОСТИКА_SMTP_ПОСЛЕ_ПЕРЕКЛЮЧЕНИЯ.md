# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ SMTP –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ—Ä–º

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

1. **–§–æ—Ä–º—ã –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω—ã –Ω–∞ SMTP:**
   - –£–±—Ä–∞–Ω –∫–ª–∞—Å—Å `web3form` –∏–∑ —Ñ–æ—Ä–º
   - –î–æ–±–∞–≤–ª–µ–Ω—ã `asp-controller` –∏ `asp-action="Submit"`
   - –î–æ–±–∞–≤–ª–µ–Ω `@Html.AntiForgeryToken()` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ

2. **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –≥–æ—Ç–æ–≤—ã:**
   - `ContactController.Submit` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É Contact
   - `AboutController.Submit` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É About
   - –û–±–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `EmailService` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ SMTP

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ SMTP –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
sudo systemctl show cloudcity | grep Email
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
Environment=Email__SmtpHost=smtp.hostinger.com
Environment=Email__SmtpPort=465
Environment=Email__SmtpUsername=support@cloudcity.center
Environment=Email__SmtpPassword=–≤–∞—à_–ø–∞—Ä–æ–ª—å
Environment=Email__RecipientEmail=support@cloudcity.center
```

**–í–∞–∂–Ω–æ:** –î–≤–æ–π–Ω–æ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ `__` –≤ `Email__SmtpPassword`!

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã

```bash
# –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u cloudcity -f
```

**–ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ä–º—É –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏.**

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- ‚úÖ `Contact form Submit called` - —Ñ–æ—Ä–º–∞ –ø–æ–ª—É—á–µ–Ω–∞
- ‚úÖ `Connecting to SMTP server` - –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ `SMTP connection established` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
- ‚úÖ `SMTP authentication successful` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
- ‚úÖ `Email sent successfully` - –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

**–û—à–∏–±–∫–∏:**
- ‚ùå `Email password not configured` - –ø–∞—Ä–æ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚ùå `Failed to connect to SMTP server` - –ø—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
- ‚ùå `SMTP authentication failed` - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å/–ª–æ–≥–∏–Ω
- ‚ùå `Connection timeout` - —Ç–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SMTP

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 465 (SSL)
openssl s_client -connect smtp.hostinger.com:465 -starttls smtp

# –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–∞ 587 (StartTLS)
telnet smtp.hostinger.com 587
```

### 4. –ï—Å–ª–∏ –ø–æ—Ä—Ç 465 –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ 587

–ò–∑–º–µ–Ω–∏—Ç–µ –≤ systemd service —Ñ–∞–π–ª–µ:
```bash
sudo nano /etc/systemd/system/cloudcity.service
```

–ù–∞–π–¥–∏—Ç–µ:
```
Environment=Email__SmtpPort=465
```

–ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞:
```
Environment=Email__SmtpPort=587
```

–ó–∞—Ç–µ–º:
```bash
sudo systemctl daemon-reload
sudo systemctl restart cloudcity
```

## üêõ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Email password not configured"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–∞—Ä–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
sudo systemctl show cloudcity | grep SmtpPassword

# –ï—Å–ª–∏ –ø—É—Å—Ç–æ, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:
sudo systemctl edit cloudcity
```

–î–æ–±–∞–≤—å—Ç–µ:
```ini
[Service]
Environment=Email__SmtpPassword=–≤–∞—à_–ø–∞—Ä–æ–ª—å
```

–ó–∞—Ç–µ–º:
```bash
sudo systemctl daemon-reload
sudo systemctl restart cloudcity
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Connection timeout"

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
- –§–∞–π—Ä–≤–æ–ª –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—ã 465/587
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç SMTP
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–æ—Å—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª:
   ```bash
   sudo ufw status
   sudo iptables -L -n | grep 465
   sudo iptables -L -n | grep 587
   ```

2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ—Ä—Ç 587 –≤–º–µ—Å—Ç–æ 465

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ö–æ—Å—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:
   ```bash
   ping smtp.hostinger.com
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "SMTP authentication failed"

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø–æ–ª–Ω—ã–π email: `support@cloudcity.center`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ –ø–∞–Ω–µ–ª–∏ Hostinger

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –§–æ—Ä–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É, –Ω–æ –≤ –ª–æ–≥–∞—Ö –Ω–µ—Ç –æ—à–∏–±–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –Ω–∞ –æ—à–∏–±–∫–∏ JavaScript
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `@Html.AntiForgeryToken()` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ñ–æ—Ä–º–µ

## üìã –ß–µ–∫–ª–∏—Å—Ç

- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (–¥–≤–æ–π–Ω–æ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ `__`)
- [ ] –ü–∞—Ä–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- [ ] –ü–æ—Ä—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (465 –∏–ª–∏ 587)
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ–ø—ã—Ç–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- [ ] –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/Contact/Submit` –∏–ª–∏ `/About/Submit`
- [ ] –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

## üöÄ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Ñ–æ—Ä–º—É
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u cloudcity -n 50`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É `support@cloudcity.center`
4. –ï—Å–ª–∏ –ø–∏—Å—å–º–æ –Ω–µ –ø—Ä–∏—à–ª–æ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–°–ø–∞–º"

---

**–ü—Ä–∏—à–ª–∏—Ç–µ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã - –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è!**

