# üõ†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã ContactMessages –≤—Ä—É—á–Ω—É—é

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL.

## SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è SQL Server

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL —Å–∫—Ä–∏–ø—Ç –≤ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `CloudCityDB`:

```sql
USE CloudCityDB;
GO

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã ContactMessages
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[ContactMessages]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[ContactMessages] (
        [Id] INT NOT NULL IDENTITY(1,1),
        [Name] NVARCHAR(200) NOT NULL,
        [Email] NVARCHAR(200) NOT NULL,
        [Phone] NVARCHAR(50) NULL,
        [Subject] NVARCHAR(200) NULL,
        [ServiceType] NVARCHAR(100) NULL,
        [Message] NVARCHAR(MAX) NOT NULL,
        [SourcePage] NVARCHAR(50) NOT NULL,
        [CreatedAt] DATETIME2 NOT NULL DEFAULT GETUTCDATE(),
        [IsRead] BIT NOT NULL DEFAULT 0,
        [ReadAt] DATETIME2 NULL,
        CONSTRAINT [PK_ContactMessages] PRIMARY KEY CLUSTERED ([Id] ASC)
    );
    
    PRINT '–¢–∞–±–ª–∏—Ü–∞ ContactMessages —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ';
END
ELSE
BEGIN
    PRINT '–¢–∞–±–ª–∏—Ü–∞ ContactMessages —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
END
GO
```

## –ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ sqlcmd

```bash
sqlcmd -S 10.151.10.8 -U sa -P –≤–∞—à_–ø–∞—Ä–æ–ª—å -d CloudCityDB -i create_contact_messages.sql
```

–ò–ª–∏ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É:

```bash
sqlcmd -S 10.151.10.8 -U sa -P –≤–∞—à_–ø–∞—Ä–æ–ª—å -d CloudCityDB -Q "CREATE TABLE [dbo].[ContactMessages] ([Id] INT NOT NULL IDENTITY(1,1), [Name] NVARCHAR(200) NOT NULL, [Email] NVARCHAR(200) NOT NULL, [Phone] NVARCHAR(50) NULL, [Subject] NVARCHAR(200) NULL, [ServiceType] NVARCHAR(100) NULL, [Message] NVARCHAR(MAX) NOT NULL, [SourcePage] NVARCHAR(50) NOT NULL, [CreatedAt] DATETIME2 NOT NULL DEFAULT GETUTCDATE(), [IsRead] BIT NOT NULL DEFAULT 0, [ReadAt] DATETIME2 NULL, CONSTRAINT [PK_ContactMessages] PRIMARY KEY CLUSTERED ([Id] ASC));"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ SQL Server Management Studio (SSMS)

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É `10.151.10.8`
2. –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö `CloudCityDB`
3. –û—Ç–∫—Ä–æ–π—Ç–µ "New Query"
4. –í—Å—Ç–∞–≤—å—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç –≤—ã—à–µ
5. –í—ã–ø–æ–ª–Ω–∏—Ç–µ (F5)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Azure Data Studio –∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–ª–∏–µ–Ω—Ç

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
2. –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç

## –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã

1. –£–¥–∞–ª–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é `AddContactMessages` (–µ—Å–ª–∏ –æ–Ω–∞ –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞):
   ```bash
   cd /home/siteadmin/cloudcity/CloudCityCenter
   dotnet ef migrations remove --project CloudCityCenter
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å –æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ç–∞–±–ª–∏—Ü–µ:
   ```bash
   export ConnectionStrings__DefaultConnection="Server=10.151.10.8;Database=CloudCityDB;User Id=sa;Password=–≤–∞—à_–ø–∞—Ä–æ–ª—å;TrustServerCertificate=True"
   dotnet ef migrations add AddContactMessages --project CloudCityCenter
   ```

3. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —É–¥–∞–ª–∏—Ç–µ –∏–∑ –Ω–µ–≥–æ –∫–æ–º–∞–Ω–¥—ã `CREATE TABLE` (—Ç–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å:
   ```bash
   sudo systemctl restart cloudcity
   ```

## –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞
sqlcmd -S 10.151.10.8 -U sa -P –≤–∞—à_–ø–∞—Ä–æ–ª—å -d CloudCityDB -Q "SELECT COUNT(*) FROM ContactMessages"
```

–î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å `0` (—Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞—è, –Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç).

---

**–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/Admin/Messages` –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å!**

