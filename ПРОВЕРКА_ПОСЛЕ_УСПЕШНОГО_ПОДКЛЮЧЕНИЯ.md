# ✅ SSL соединение работает! Проверка приложения

## Отлично! 

SSL соединение с `smtp.hostinger.com:465` **работает** - видно:
- ✅ TLSv1.3 соединение установлено
- ✅ Сертификат проверен (Verify return code: 0 (ok))
- ✅ Сервер отвечает: `220 ESMTP smtp.hostinger.com`

## Проблема теперь в приложении

Если SSL работает через openssl, но приложение не может подключиться, возможные причины:

### 1. Проверьте переменные окружения

```bash
sudo systemctl show cloudcity | grep Email
```

Убедитесь, что:
- `Email__SmtpPort=465` (двойное подчеркивание!)
- `Email__SmtpPassword` установлен
- `Email__SmtpUsername=support@cloudcity.center`

### 2. Проверьте логи приложения

```bash
sudo journalctl -u cloudcity -f
```

Отправьте форму и смотрите. Должны быть видны:
- `Email configuration: Host=..., Port=465, PasswordSet=True`
- `Connecting to SMTP server: smtp.hostinger.com:465`
- `Using SSL on connect (port 465)`
- `Attempting to connect...`

### 3. Возможные проблемы

**Проблема A: Неправильный порт в переменных**
- Проверьте, что `Email__SmtpPort=465` (не 587)

**Проблема B: Проблема с SSL опциями**
- Для порта 465 должно быть `SslOnConnect`
- Код уже настроен правильно

**Проблема C: Таймаут слишком короткий**
- Текущий таймаут: 30 секунд
- Может быть недостаточно, если сеть медленная

**Проблема D: Проблема с сертификатом**
- Временно отключите проверку для диагностики:
  ```ini
  Environment=Email__CheckCertificate=false
  ```

### 4. Тест с портом 465

Убедитесь, что в файле сервиса:
```ini
Environment=Email__SmtpPort=465
Environment=Email__UseSsl=true
```

### 5. Перезапустите и проверьте

```bash
sudo systemctl daemon-reload
sudo systemctl restart cloudcity
sudo journalctl -u cloudcity -f
```

Отправьте форму и смотрите логи.

## Если все еще таймаут

Попробуйте увеличить таймаут в коде или временно отключить проверку сертификата для диагностики.

---

**SSL работает, значит проблема в настройках приложения или таймаутах!**


